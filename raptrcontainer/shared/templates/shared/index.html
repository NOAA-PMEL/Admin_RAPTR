{% extends "shared/base.html" %}
{% load render_table from django_tables2 %}
{% load bootstrap4 %}
{% load static %}
{% load shared_filters %}

{% block content %}

  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>

  <link rel="stylesheet" type="text/css" href="{% static 'raptr/content/style.css' %}">

  <div class="row">
    <div class="col-md-3">
      <h4 class="text-center">FY 2019 R&A Funds by Division</h4>
      <table class="table table-bordered table-condensed table-striped">
        <tr>
          <div class="container">
            <div>
              <canvas id="myChart"></canvas>
            </div>
          </div>
        </tr>
        <thead>
        <tr class="by_division_header">
          <th scope="col">Division</th>
          <th scope="col">Funds Received</th>
        </tr>
        </thead>
        {% if by_division %}
          {% for division in by_division %}
            <tr>
              <td>{{ division.division }}</td>
              <td class="text-right">{{ division.budget__sum|currency }}</td>
            </tr>
          {% endfor %}
        {% else %}
        <tr>
          <td>No data retrieved.</td>
          <td></td>
        </tr>
        {% endif %}
        <tr>
          <td><strong>Total</strong></td>
          <td class="text-right"><strong>{{ by_division_total.budget__sum|currency }}</strong></td>
        </tr>
      </table>
    </div>
    <div class="col-md-3">
      <h4 class="text-center">FY 2019 R&A Funds by Research Program</h4>
      <table class="table table-bordered table-condensed table-striped">
        <tr>
          <img class="img-responsive" src="{% static 'raptr/images/by_rp.png' %}" width="350" height="350" align="center" alt="By Research Program">
        </tr>
        <thead>
        <tr class="by_research_program_header">
          <th scope="col">Research Program</th>
          <th scope="col">Funds Received</th>
        </tr>
        </thead>
        {% if by_research_program %}
          {% for rp in by_research_program %}
            <tr>
              <td>{{ rp.research_program }}</td>
              <td class="text-right">{{ rp.budget__sum|currency }}</td>
            </tr>
          {% endfor %}
        {% else %}
        <tr>
          <td>No data retrieved.</td>
          <td></td>
        </tr>
        {% endif %}
        <tr>
          <td><strong>Total</strong></td>
          <td class="text-right"><strong>{{ by_research_program_total.budget__sum|currency }}</strong></td>
        </tr>
      </table>
    </div>
  </div>

    <script>
      var ctx = document.getElementById('myChart').getContext('2d');
      var myChart = new Chart(ctx, {
        type: 'pie',
        data: {
          labels: by_division_graph_data,
          datasets: [{
            label: "Funds Received",
            backgroundColor: ["#4472C4", "#ED7D31", "#A5A5A5", "#FFC000", "#008000"],
            data: [235000, 104714, 90937, 25000]
          }]
        },
        options: {
          title: {
            display: false,
            text: 'FY19 New Funds Received'
          },
          legend: {
            position: 'bottom'
          },
          tooltips: {
            callbacks: {
              label: function(tooltipItem, data) {
                return data['labels'][tooltipItem['index']] + ': $' + data['datasets'][0]['data'][tooltipItem['index']].toLocaleString();
              },
              afterLabel: function(tooltipItem, data) {
                var dataset = data['datasets'][0];
                var percent = Math.round((dataset['data'][tooltipItem['index']] / dataset["_meta"][0]['total']) * 100)
                return '(' + percent + '%)';
              }
            }
          }
        }
      })
    </script>

{% endblock %}