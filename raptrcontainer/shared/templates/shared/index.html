{% extends "shared/base.html" %}
    {% load shared_filters %}

<script>
{% block jquery %}
var endpoint = 'api/data/'
var defaultData = []
var labels = [];
$.ajax({
    method: "GET",
    url: endpoint,
    success: function(data){
        labels = data.labels
        defaultData = data.default
        console.log("success")
        setChart()
    },
    error: function(error_data){
        console.log("error")
        console.log(error_data)
    }
})
function setChart(){
    var ctx = document.getElementById('byDivisionChart').getContext('2d');
    var byDivisionChart = new Chart(ctx, {
      type: 'pie',
      data: {
        labels: labels,
        datasets: [{
          label: "Funds Received",
          backgroundColor: ["#4472C4", "#ED7D31", "#A5A5A5", "#FFC000", "#008000"],
          data: defaultData
        }]
      },
      options: {
        title: {
          display: false,
        },
        legend: {
          position: 'right'
        },
        tooltips: {
          callbacks: {
            label: function(tooltipItem, data) {
              return data['labels'][tooltipItem['index']] + ': $' + data['datasets'][0]['data'][tooltipItem['index']].toLocaleString();
            },
<!--            afterLabel: function(tooltipItem, data) {-->
<!--              var dataset = data['datasets'][0];-->
<!--              var percent = Math.round((dataset['data'][tooltipItem['index']] / dataset["_meta"][0]['total']) * 100)-->
<!--              return '(' + percent + '%)';-->
<!--            }-->
          }
        }
      }
    })
}
{% endblock %}

</script>

{% block content %}
  <div class="row">
    <div class="col-md-3">
      <h4 class="text-center">FY 2019 R and A Funds by Division</h4>
      <table class="table table-bordered table-condensed table-striped">
      <thead>
        <tr>
            <td colspan="2">
              <div class="container">
                <canvas id="byDivisionChart"></canvas>
              </div>
            </td>
          </tr>
        </thead>
        <tr class="by_division_header">
          <th scope="col">Division</th>
          <th scope="col">Funds Received</th>
        </tr>
        {% if by_division %}
          {% for division in by_division %}
            <tr>
              <td>{{ division.division }}</td>
              <td class="text-right">{{ division.budget__sum|currency }}</td>
            </tr>
          {% endfor %}
        {% else %}
        <tr>
          <td>No data retrieved.</td>
          <td></td>
        </tr>
        {% endif %}
        <tr>
          <td><strong>Total</strong></td>
          <td class="text-right"><strong>{{ by_division_total.budget__sum|currency }}</strong></td>
        </tr>
      </table>
    </div>
    <div class="col-md-3">
      <h4 class="text-center">FY 2019 R and A Funds by Research Program</h4>
      <table class="table table-bordered table-condensed table-striped">
        <thead>
        <tr>
          <td colspan="2">
            <div class="container">
              <canvas id="byResearchProgramChart"></canvas>
            </div>
          </td>
        </tr>
        </thead>
        <tr class="by_research_program_header">
          <th scope="col">Research Program</th>
          <th scope="col">Funds Received</th>
        </tr>
        {% if by_research_program %}
          {% for rp in by_research_program %}
            <tr>
              <td>{{ rp.research_program }}</td>
              <td class="text-right">{{ rp.budget__sum|currency }}</td>
            </tr>
          {% endfor %}
        {% else %}
        <tr>
          <td>No data retrieved.</td>
          <td></td>
        </tr>
        {% endif %}
        <tr>
          <td><strong>Total</strong></td>
          <td class="text-right"><strong>{{ by_research_program_total.budget__sum|currency }}</strong></td>
        </tr>
      </table>
    </div>
  </div>


<script>
    var ctx2 = document.getElementById('byResearchProgramChart').getContext('2d');
    var byResearchProgramChart = new Chart(ctx2, {
      type: 'pie',
      data: {
        labels: ["ED","CO2", "EOI", "AD", "Arctic"],
        datasets: [{
          label: "Funds Received",
          backgroundColor: ["#4472C4", "#ED7D31", "#A5A5A5", "#FFC000", "#008000"],
          data: [235000, 33126, 31476, 15000, 15000]
        }]
      },
      options: {
        title: {
          display: false,
        },
        legend: {
          position: 'right'
        },
        tooltips: {
          callbacks: {
            label: function(tooltipItem, data) {
              return data['labels'][tooltipItem['index']] + ': $' + data['datasets'][0]['data'][tooltipItem['index']].toLocaleString();
            },
<!--            afterLabel: function(tooltipItem, data) {-->
<!--              var dataset2 = data['datasets'][0];-->
<!--              var percent2 = Math.round((dataset['data'][tooltipItem['index']] / dataset["_meta"][0]['total']) * 100)-->
<!--              return '(' + percent2 + '%)';-->
<!--            }-->
          }
        }
      }
    })
</script>
{% endblock %}